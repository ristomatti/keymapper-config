# Aliases
AltGr = AltRight
Win   = MetaLeft

MouseButton      = ButtonLeft | ButtonRight | ButtonMiddle | ButtonBack | ButtonForward
NumericKey       = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
LetterKey        = A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P | Q | R | S | T | U | V | W | X | Y | Z
WM_DesktopKey    = NumericKey | M | P | Equal
WM_ScratchpadKey = K | S | T | O
WM_ShortcutKey   = WM_DesktopKey | WM_ScratchpadKey | C | A | W | V | T | H | N | Enter

# Alt
Alt = !Win !Control !AltGr !MouseButton AltLeft
AltOnly = !Win !Control !AltGr !MouseButton AltLeft
ControlOnly = !Win !AltGr !MouseButton

# Directional navigation keys
KeyUp       = I
KeyLeft     = J
KeyDown     = K
KeyRight    = L

# Pass-through common modifiers
Control     >> Control
Shift       >> Shift
Win         >> Win

# CapsWord emulation
CapsWordInput = Virtual1
CapsWordKey   = LetterKey | NumericKey | Minus | Backspace

CapsLock >> CapsLock CapsWordInput

[modifier="CapsWordInput"]
  Minus            >> '_'
  CapsWordKey      >> CapsWordKey
  !CapsWordKey Any >> CapsLock CapsWordInput Any

[default]
  Leader = Comma

# Keychron K15 Pro
[device=/Keychron K15 Pro/]
  Macro1       = F13
  Option       = F14
  Command      = F15
  Lock         = F16
  SpaceLeft    = F17
  EscMiddle    = F18

  SpaceKey     = Space | SpaceLeft
  Macro1                           >> F13

  SpaceLeft{!125ms}                >> Space
  EscMiddle{!125ms}                >> Escape

  # GlobalLeader = SpaceLeft !150ms
  # GlobalLeader WM_ShortcutKey     >> Win{WM_ShortcutKey}

  (SpaceLeft Shift){WM_DesktopKey} >> Win{Shift{WM_DesktopKey}}

  SpaceLeft{WM_ShortcutKey}        >> Win{WM_ShortcutKey}

  SpaceLeft{KeyUp}                 >> Win{BracketLeft}
  SpaceLeft{KeyLeft}               >> Win{Semicolon}
  SpaceLeft{KeyDown}               >> Win{Quote}
  SpaceLeft{KeyRight}              >> Win{Backslash}

  SpaceLeft{Quote}                 >> 'ä'
  SpaceLeft{Semicolon}             >> 'ö'
  SpaceLeft{Any}                   >>

  AdieresisKey = A | Quote
  OdieresisKey = O | Semicolon

  AltGr{AdieresisKey}              >> AltGr{Q}
  AltGr{OdieresisKey}              >> AltGr{P}
  AltGr{E}                         >> AltGr{5}
  AltGr{2}                         >> Shift{2}
  AltGr{4}                         >> Shift{4}

[device=/Keychron K15 Pro/ class=/slack|google-chrome/i]
  LeaderEsc = EscMiddle !150ms

  EscMiddle{!125ms} >> Escape
  LeaderEsc F       >> slack_switch_channel
  LeaderEsc 1       >> slack_goto_workspace1
  LeaderEsc 2       >> slack_goto_workspace2
  LeaderEsc H       >> slack_goto_home
  LeaderEsc A       >> slack_goto_activity
  LeaderEsc D       >> slack_goto_dms
  LeaderEsc T       >> slack_goto_threads
  LeaderEsc L       >> slack_goto_later

  LeaderEsc T       >> new_tab
  LeaderEsc X       >> close_tab
  LeaderEsc L       >> goto_location

# Keychron K3 Pro
[device=/Keychron K3 Pro/ class="kitty" title=/^.* - N?VIM$/]
  BracketLeft        >> Escape

# Webstorm
[class="jetbrains-webstorm"]
  !Control !AltLeft Shift{Enter} >> End

# Slack
[class="slack"]
  Leader F          >> slack_switch_channel
  Leader 1          >> slack_goto_workspace1
  Leader 2          >> slack_goto_workspace2
  Leader H          >> slack_goto_home
  Leader A          >> slack_goto_activity
  Leader D          >> slack_goto_dms
  Leader T          >> slack_goto_threads
  Leader L          >> slack_goto_later

  Alt{Space}        >> slack_switch_channel
  Alt{1}            >> slack_goto_workspace1
  Alt{2}            >> slack_goto_workspace2
  Alt{Tab}          >> slack_next_section
  Alt{Shift{Tab}}   >> slack_prev_section
  Alt{KeyUp}        >> slack_prev_chat
  Alt{KeyDown}      >> slack_next_chat

  Alt{KeyLeft}      >> navigate_back
  Alt{KeyRight}     >> navigate_forward

  slack_goto_home         >> (Control Shift){1}
  slack_goto_dms          >> (Control Shift){2}
  slack_goto_activity     >> (Control Shift){3}
  slack_goto_later        >> (Control Shift){4}
  slack_goto_threads      >> (Control Shift){T}
  slack_switch_channel    >> Control{K}
  slack_next_chat         >> AltLeft{ArrowDown}
  slack_prev_chat         >> AltLeft{ArrowUp}
  slack_goto_workspace1   >> Control{1}
  slack_goto_workspace2   >> Control{2}
  slack_next_section      >> F6
  slack_prev_section      >> Shift{F6}

# Chrome
[class="google-chrome"]
  Leader T          >> new_tab
  Leader X          >> close_tab
  Leader L          >> goto_location

  AltGr{T}          >> new_tab
  AltGr{W}          >> close_tab
  AltGr{Any}        >> AltGr{Any}

  Alt{T}            >> new_tab
  Alt{W}            >> close_tab
  Alt{PageUp}       >> prev_tab
  Alt{PageDown}     >> next_tab

  Alt{KeyLeft}      >> prev_tab
  Alt{KeyRight}     >> next_tab
  Alt{KeyUp}        >> scroll_up
  Alt{KeyDown}      >> scroll_down

  goto_location     >> !Win Control{L}
  scroll_up         >> ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp
  scroll_down       >> ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown

[default]
  AltLeft{Any}     >> AltLeft{Any}
  AltGr{Any}       >> AltGr{Any}
  AltLeft          >>
  AltGr            >>

  new_tab          >> !Win Control{T}
  close_tab        >> !Win Control{W}
  prev_tab         >> !Win Control{PageUp}
  next_tab         >> !Win Control{PageDown}
  navigate_back    >> !Win AltLeft{ArrowLeft}
  navigate_forward >> !Win AltLeft{ArrowRight}

[device="MX Anywhere 2S Mouse"]

# vim: ft=perl sw=2 ts=2 expandtab
