# Aliases
AltGr = AltRight
Win   = MetaLeft

MouseButton      = ButtonLeft | ButtonRight | ButtonMiddle | ButtonBack | ButtonForward
NumericKey       = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
LetterKey        = A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P | Q | R | S | T | U | V | W | X | Y | Z
WM_DesktopKey    = NumericKey | M | P | Equal
WM_ScratchpadKey = K | S | T | O
WM_ShortcutKey   = WM_DesktopKey | WM_ScratchpadKey | C | A | W | V | T | H | N | Enter

# Alt
Alt = !Win !Control !AltGr !MouseButton AltLeft

# Directional navigation keys
KeyUp       = I
KeyLeft     = J
KeyDown     = K
KeyRight    = L

# Pass-through common modifiers
Control     >> Control
Shift       >> Shift
Win         >> Win

# CapsWord emulation
CapsWordInput = Virtual1
CapsWordKey   = LetterKey | NumericKey | Minus | Backspace

CapsLock >> CapsLock CapsWordInput

[default]
  LeaderKey   = Comma
  Leader      = LeaderKey !150ms

[modifier="CapsWordInput"]
  Minus            >> '_'
  CapsWordKey      >> CapsWordKey
  !CapsWordKey Any >> CapsLock CapsWordInput Any

# Keychron K15 Pro
[device=/Keychron K15 Pro/]
  ISONordic    = Virtual3

  M1           = F13
  Option       = F14
  Command      = F15
  Lock         = F16
  SpaceLeft    = F17
  EscMiddle    = F18

  LeaderKey    = EscMiddle
  Leader       = LeaderKey !150ms
  GlobalLeader = SpaceLeft !150ms

  SpaceKey     = Space | SpaceLeft

  M1                          >> F13
  Option                      >>
  Command{Any}                >> Win{Shift{Any}}
  Lock{SpaceKey}              >> ISONordic

  LeaderKey{!150ms}           >> Escape
  SpaceLeft{!125ms}           >> Space

  # GlobalLeader WM_ShortcutKey     >> Win{WM_ShortcutKey}
  (SpaceLeft Shift){WM_DesktopKey} >> Win{Shift{WM_DesktopKey}}

  SpaceLeft{WM_ShortcutKey}        >> Win{WM_ShortcutKey}

  SpaceLeft{KeyUp}              >> Win{BracketLeft}
  SpaceLeft{KeyLeft}            >> Win{Semicolon}
  SpaceLeft{KeyDown}            >> Win{Quote}
  SpaceLeft{KeyRight}           >> Win{Backslash}

  (SpaceLeft Shift){Quote}      >> 'Ä'
  (SpaceLeft Shift){Semicolon}  >> 'Ö'
  SpaceLeft{Quote}              >> 'ä'
  SpaceLeft{Semicolon}          >> 'ö'
  SpaceLeft{Any}                >>

[device=/Keychron K15 Pro/ modifier="ISONordic" class="slack"]
  AltGr{Shift{Quote}}         >> '"'
  AltGr{Quote}                >> "'"
  Shift{Quote}                >> 'Ä'
  Shift{Semicolon}            >> 'Ö'
  Quote                       >> 'ä'
  Semicolon                   >> 'ö'
  Shift{Comma}                >> Shift{Comma}
  Shift{Period}               >> Shift{Period}

[device=/Keychron K15 Pro/ modifier="!AltGr ISONordic"]
  Shift{Semicolon}            >> ':'
  Semicolon                   >> ';'
  Shift{Quote}                >> '"'
  Quote                       >> "'"
  Shift{Comma}                >> '<'
  Shift{Period}               >> '>'
  Shift{BracketLeft}          >> '{'
  BracketLeft                 >> '['
  Shift{BracketRight}         >> '}'
  BracketRight                >> ']'
  Shift{2}                    >> '@'
  Shift{3}                    >> '#'
  Shift{4}                    >> '$'
  Shift{5}                    >> '%'
  Shift{6}                    >> '^' # !Shift Backquote # '^'
  Shift{7}                    >> '&'
  Shift{8}                    >> '*'
  Shift{9}                    >> '('
  Shift{0}                    >> ')'
  Shift{Minus}                >> '_'
  Minus                       >> '-'
  Shift{Equal}                >> '+'
  Equal                       >> '='
  Shift{Slash}                >> '?'
  Slash                       >> '/'
  Shift{Backslash}            >> '|'
  Backslash                   >> AltGr{Minus}
  Shift{Backquote}            >> '~'
  # Backquote                   >> Backquote

[device=/Keychron K15 Pro/ modifier="AltGr ISONordic"]
  Backquote                   >> '`'
  Shift{A}                    >> 'Ä'
  A                           >> 'ä'
  Shift{O}                    >> 'Ö'
  O                           >> 'ö'
  Shift{Backslash}            >> 'Ä'
  Backslash                   >> 'ä'
  Shift{Semicolon}            >> 'Ö'
  Semicolon                   >> 'ö'
  Shift{Any}                  >> Shift{Any}

# Keychron K3 Pro
[device=/Keychron K3 Pro/]
  Leader      = Comma !150ms

[device=/Keychron K3 Pro/ class="kitty" title=/^.* - N?VIM$/]
  BracketLeft           >> Escape

# Webstorm
[class="jetbrains-webstorm"]
  !Control !AltLeft Shift{Enter} >> End

# Slack
[class="slack"]
  LeaderKey{!150ms} >> LeaderKey

  Leader F          >> switch_channel
  Leader 1          >> goto_workspace1
  Leader 2          >> goto_workspace2
  Leader H          >> goto_home
  Leader A          >> goto_activity
  Leader D          >> goto_dms
  Leader T          >> goto_threads
  Leader L          >> goto_later

  Alt{Space}        >> switch_channel
  Alt{1}            >> goto_workspace1
  Alt{2}            >> goto_workspace2
  Alt{KeyUp}        >> prev_chat
  Alt{KeyDown}      >> next_chat
  Alt{KeyLeft}      >> navigate_back
  Alt{KeyRight}     >> navigate_forward
  Alt{Tab}          >> next_section
  Alt{Shift{Tab}}   >> prev_section

  goto_home         >> (Control Shift){1}
  goto_dms          >> (Control Shift){2}
  goto_activity     >> (Control Shift){3}
  goto_later        >> (Control Shift){4}
  goto_threads      >> (Control Shift){T}
  switch_channel    >> Control{K}
  next_chat         >> AltLeft{ArrowDown}
  prev_chat         >> AltLeft{ArrowUp}
  goto_workspace1   >> Control{1}
  goto_workspace2   >> Control{2}
  next_section      >> F6
  prev_section      >> Shift{F6}

# Chrome
[class="google-chrome"]
  LeaderKey{!150ms} >> Comma

  Leader T          >> new_tab
  Leader X          >> close_tab
  Leader L          >> goto_location

  AltGr{T}          >> new_tab
  AltGr{W}          >> close_tab
  AltGr{Any}        >> AltGr{Any}

  Alt{T}            >> new_tab
  Alt{W}            >> close_tab
  Alt{PageUp}       >> prev_tab
  Alt{PageDown}     >> next_tab

  Alt{KeyLeft}      >> prev_tab
  Alt{KeyRight}     >> next_tab
  Alt{KeyUp}        >> scroll_up
  Alt{KeyDown}      >> scroll_down

  goto_location     >> !Win Control{L}
  scroll_up         >> ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp
  scroll_down        >> ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown

[default]
  AltLeft          >> AltLeft
  AltGr            >> AltGr

  new_tab          >> !Win Control{T}
  close_tab        >> !Win Control{W}
  prev_tab         >> !Win Control{PageUp}
  next_tab         >> !Win Control{PageDown}
  navigate_back    >> !Win AltLeft{ArrowLeft}
  navigate_forward >> !Win AltLeft{ArrowRight}

[device="MX Anywhere 2S Mouse"]

# vim: ft=perl sw=2 ts=2 expandtab
