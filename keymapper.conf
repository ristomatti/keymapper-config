# Immediately forward common modifiers
Meta          >> Meta
Control       >> Control
AltRight      >> AltRight

# Allow using Alt as modifier without breaking window move/resize with Alt held
Alt           = !ButtonLeft !ButtonRight AltLeft

# Intl. layout modifiers
AltGr         = AltRight

# Exact modifiers
_Meta         = !Control       !AltLeft !AltGr !Shift MetaLeft
_MetaRight    = !Control       !AltLeft !AltGr !Shift MetaRight
_Alt          = !Control !Meta          !AltGr !Shift AltLeft
_AltGr        = !Control !Meta !AltLeft        !Shift AltGr
_Control      =          !Meta !AltLeft !AltGr !Shift ControlLeft
_ControlRight =          !Meta !AltLeft !AltGr !Shift ControlRight
_Shift        = !Control !Meta !AltLeft !AltGr ShiftLeft
_ShiftRight   = !Control !Meta !AltLeft !AltGr ShiftRight

# Key groups
MouseButton   = ButtonLeft | ButtonRight | ButtonMiddle | ButtonBack | ButtonForward
Number        = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
Letter        = A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P | Q | R | S | T | U | V | W | X | Y | Z

# Directional navigation keys
KeyUp         = I
KeyLeft       = J
KeyDown       = K
KeyRight      = L
Direction     = KeyUp | KeyLeft | KeyDown | KeyRight

# Window manager shortcut keys
Workspace     = Number | M | P | Minus
ScratchpadApp = S | T | O
WMShortcut    = Workspace | ScratchpadApp | Enter | Space | Escape | C | F | R | A | Z | W | V | H | N

LeaderMod     = F15
ScratchpadMod = F13


# QMK inspired CapsWord Key
[default]
  CapsWordToggle = Virtual1
  CapsWord       = CapsLock CapsWordToggle ^
  CapsWordKey    = Letter | Number | Minus | Backspace

  Shift{200ms}          >> Shift
  ShiftLeft{ShiftRight} >> CapsWord
  Shift{CapsLock}       >> CapsWord

[modifier="CapsWordToggle"]
  Minus            >> Shift{Minus} # '_'
  CapsWordKey      >> CapsWordKey
  !CapsWordKey Any >> CapsLock CapsWordToggle Any


# Default mappings
[default]
  LeaderKey = Comma
  Leader    = LeaderKey !150ms

  # Mouse button actions
  ButtonForward{150ms}             >> window_move
  ButtonBack{150ms}                >> window_resize
  ButtonForward !150ms ButtonRight >> wm_close_window


# Logitech MX Anywhere 2S
[device="MX Anywhere 2S Mouse"]
  ButtonMiddle{150ms}              >> wm_float_toggle


# Keychron K3 Pro mappings for VIM/NVIM
[device=/Keychron K3 Pro/]
  Backquote     >> ScratchpadMod    # F13
  BracketRight  >> LeaderMod{200ms} # F15


# Keychron K3 Pro mappings for VIM/NVIM
[device=/Keychron K3 Pro/ title=/^.* - N?VIM$/]
  BracketLeft   >> Escape


# Keychron K15 Pro key definitions
[device=/Keychron K15 Pro Keyboard/]
  # Left side macro keys
  Macro1        = ScratchpadMod # F13
  Option        = F14
  Command       = F15
  Lock          = F16

  # Split spacebar
  SpaceLeft     = F17
  SpaceKey      = Space | SpaceLeft

  # Escape between spacebar splits
  EscMiddle     = F18
  LeaderEsc     = EscMiddle !250ms

  # Rotary encoder
  EncoderButton = NumpadEnter
  EncoderRight  = NumpadAdd
  EncoderLeft   = NumpadSubtract


# Keychron K15 Pro encoder mappings for Rofi menus
[device=/Keychron K15 Pro Keyboard/ title=/rofi/i]
  EncoderButton >> Enter ^
  EncoderRight  >> ArrowDown
  EncoderLeft   >> ArrowUp


# Keychron K15 Pro default mappings
[device=/Keychron K15 Pro Keyboard/]
  Macro1                           >> $($HOME/.config/regolith/rofi/rofi-hass-scene.sh) ^
  Option                           >> $(rofimoji --selector-args="-normal-window" --skin-tone neutral --prompt emoji --keybinding-copy Control-c) ^

  Command !500ms Command           >> $(rofi -normal-window -show window) ^
  Command !2000ms R               >> $(rofi -normal-window -show run) ^
  Command !3000ms L               >> $($HOME/.config/regolith/rofi/rofi-hass-scene.sh) ^

  # Switch keyboard layout
  Lock{200ms}                      >> Shift{Lock} 200ms ShiftLeft ^
  Lock                             >>

  # WM encoder mappings
  ControlRight{EncoderButton}      >>
  ControlRight{EncoderRight}       >> Meta{Tab}
  ControlRight{EncoderLeft}        >> Meta{Shift{Tab}}

  # Default encoder mappings
  EncoderButton                    >> AudioVolumeMute ^
  EncoderRight                     >> AudioVolumeUp
  EncoderLeft                      >> AudioVolumeDown

  EscMiddle{!200ms}                >> Escape
  EscMiddle                        >>

  # Disable default leader key
  LeaderKey                        >> LeaderKey

  # Directional tiled window movement
  (SpaceLeft ShiftLeft){KeyUp}     >> Meta{Shift{BracketLeft}} ^
  (SpaceLeft ShiftLeft){KeyLeft}   >> Meta{Shift{Semicolon}} ^
  (SpaceLeft ShiftLeft){KeyDown}   >> Meta{Shift{Quote}} ^
  (SpaceLeft ShiftLeft){KeyRight}  >> Meta{Shift{Backslash}} ^

  # Move window to workspace
  (SpaceLeft ShiftLeft){Workspace} >> Meta{Shift{Workspace}} ^

  # WM shortcuts used with Meta
  SpaceLeft{WMShortcut}            >> Meta{WMShortcut}

  # Directional tiled window focus
  SpaceLeft{KeyUp}                 >> Meta{BracketLeft}
  SpaceLeft{KeyLeft}               >> Meta{Semicolon}
  SpaceLeft{KeyDown}               >> Meta{Quote}
  SpaceLeft{KeyRight}              >> Meta{Backslash}

  SpaceLeft{BracketLeft}           >> wm_show_terminal
  SpaceLeft{Q}                     >> wm_close_window
  SpaceLeft{Quote}                 >> type_adieresis
  SpaceLeft{Semicolon}             >> type_odieresis

  SpaceLeft                        >> Space

  # Editor actions
  AltGr{Insert}                    >> End
  AltGr{Backspace}                 >> Delete

  # Nordic symbol mappings
  AdieresisKey = A | Quote
  OdieresisKey = O | Semicolon

  AltGr{AdieresisKey}              >> type_adieresis  # 'ä'
  AltGr{OdieresisKey}              >> type_odieresis  # 'ö'
  AltGr{E}                         >> AltGr{5}        # '€'
  AltGr{2}                         >> !AltGr Shift{2} # '@'
  AltGr{4}                         >> !AltGr Shift{4} # '$'
  AltGr{BracketLeft}               >> !AltGr Shift{9} # '('
  AltGr{BracketRight}              >> !AltGr Shift{0} # ')'

  # Long-pres shortcuts
  Backslash{120ms}                 >> wm_show_terminal
  Backslash                        >> Backslash
  Backquote{120ms}                 >> ScratchpadMod
  Backquote                        >> Backquote

  type_adieresis                   >> AltGr{Q}
  type_odieresis                   >> AltGr{P}

# Keychron K15 Pro mappings for specific email, chat, etc.
[device=/Keychron K15 Pro Keyboard/ title=/gmail|outlook|slack|telegram|whatsapp|ticktick/i]
  Quote{120ms}       >> Quote ^
  Semicolon{120ms}   >> Semicolon ^
  Quote              >> type_adieresis
  Semicolon          >> type_odieresis


# Keychron K15 Pro mappings for Chrome/Chromium
[device=/Keychron K15 Pro Keyboard/ class=/chrome|chromium/i]
  LeaderEsc T       >> new_tab
  LeaderEsc X       >> close_tab
  LeaderEsc W       >> close_tab
  LeaderEsc L       >> goto_location


# Keychron K15 Pro leader mappings for Slack
[device=/Keychron K15 Pro Keyboard/ class="slack"]
  LeaderEsc F       >> slack_switch_channel
  LeaderEsc 1       >> slack_goto_workspace1
  LeaderEsc 2       >> slack_goto_workspace2
  LeaderEsc H       >> slack_goto_home
  LeaderEsc A       >> slack_goto_activity
  LeaderEsc D       >> slack_goto_dms
  LeaderEsc T       >> slack_goto_threads
  LeaderEsc L       >> slack_goto_later
  LeaderEsc M       >> slack_mic_mute_toggle


# Jetbrains IDE mappings
[class=/jetbrains-/]
  Editor = E
  Focus  = F
  Goto   = G

  FocusKey = Direction | N | P

  Editor{Direction}   >> AltGr{Control{Direction}}
  Editor{Any}         >> Editor Any

  Focus{FocusKey}     >> AltGr{AltLeft{FocusKey}}
  Focus{Any}          >> Focus Any

  Goto{D}             >> goto_declaration
  Goto{I}             >> goto_implementation
  Goto{F}             >> goto_file
  Goto{S}             >> goto_symbol
  Goto{Any}           >> Goto Any

  Editor{!75ms}       >> Editor
  Focus{!75ms}        >> Focus
  Goto{!75ms}         >> Goto

  !Control !AltLeft Shift{Enter} >> End

  goto_declaration    >> Control{B}
  goto_implementation >> Control{AltLeft{B}}
  goto_file           >> AltLeft{P}
  goto_symbol         >> AltLeft{Shift{P}}


# Slack mappings
[class="slack"]
  Leader F                >> slack_switch_channel
  Leader 1                >> slack_goto_workspace1
  Leader 2                >> slack_goto_workspace2
  Leader H                >> slack_goto_home
  Leader A                >> slack_goto_activity
  Leader D                >> slack_goto_dms
  Leader T                >> slack_goto_threads
  Leader L                >> slack_goto_later

  Alt{Space}              >> slack_switch_channel
  Alt{1}                  >> slack_goto_workspace1
  Alt{2}                  >> slack_goto_workspace2
  Alt{Tab}                >> slack_next_section
  Alt{Shift{Tab}}         >> slack_prev_section
  Alt{KeyUp}              >> slack_prev_chat
  Alt{KeyDown}            >> slack_next_chat
  Alt{M}                  >> slack_mic_mute_toggle

  Alt{KeyLeft}            >> navigate_back
  Alt{KeyRight}           >> navigate_forward

  slack_goto_home         >> (Control Shift){1}
  slack_goto_dms          >> (Control Shift){2}
  slack_goto_activity     >> (Control Shift){3}
  slack_goto_later        >> (Control Shift){4}
  slack_goto_threads      >> (Control Shift){T}
  slack_switch_channel    >> Control{K}
  slack_mic_mute_toggle   >> (Control Shift){Space}
  slack_next_chat         >> AltLeft{ArrowDown}
  slack_prev_chat         >> AltLeft{ArrowUp}
  slack_goto_workspace1   >> Control{1}
  slack_goto_workspace2   >> Control{2}
  slack_next_section      >> F6
  slack_prev_section      >> Shift{F6}


# Browser mappings
[class=/chrome|chromium|firefox/i]
  Leader T          >> new_tab
  Leader X          >> close_tab
  Leader L          >> goto_location

  AltGr{T}          >> new_tab
  AltGr{W}          >> close_tab
  AltGr{Any}        >> AltGr{Any}

  Alt{T}            >> new_tab
  Alt{W}            >> close_tab
  Alt{PageUp}       >> prev_tab
  Alt{PageDown}     >> next_tab

  Alt{KeyLeft}      >> prev_tab
  Alt{KeyRight}     >> next_tab
  Alt{KeyUp}        >> scroll_up
  Alt{KeyDown}      >> scroll_down

  goto_location     >> !Meta Control{L}
  scroll_up         >> ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp
  scroll_down       >> ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown


# Default abstract mappings
[default]
  new_tab           >> !Meta Control{T}
  close_tab         >> !Meta Control{W}
  prev_tab          >> !Meta Control{PageUp}
  next_tab          >> !Meta Control{PageDown}
  navigate_back     >> !Meta AltLeft{ArrowLeft}
  navigate_forward  >> !Meta AltLeft{ArrowRight}

  window_move       >> (AltLeft ButtonLeft)
  window_resize     >> (AltLeft ButtonRight)

  wm_show_terminal  >> Meta{K} ^
  wm_close_window   >> ^Meta{Shift{Q}}
  wm_float_toggle   >> Meta{Escape} ^


# vim: ft=perl sw=2 ts=2 expandtab

