# Aliases
AltGr    = AltRight
Win      = MetaLeft

# Exact modifiers
_Meta         = !Control       !AltLeft !AltGr Meta
_MetaLeft     = !Control       !AltLeft !AltGr MetaLeft
_MetaRight    = !Control       !AltLeft !AltGr MetaRight
_AltLeft      = !Control !Meta          !AltGr AltLeft
_AltGr        = !Control !Meta !AltLeft        AltGr
_Control      =          !Meta !AltLeft !AltGr Control
_ControlLeft  =          !Meta !AltLeft !AltGr ControlLeft
_ControlRight =          !Meta !AltLeft !AltGr ControlRight

MouseButton   = ButtonLeft | ButtonRight | ButtonMiddle | ButtonBack | ButtonForward
Number        = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
Letter        = A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P | Q | R | S | T | U | V | W | X | Y | Z

Workspace     = Number | M | P | Minus
Scratchpad    = S | T | O
WMShortcut    = Workspace | Scratchpad | C | F | R | A | Z | W | V | H | N | Enter | Space | Escape

# Alt
Alt = !ButtonLeft !ButtonRight AltLeft

# Directional navigation keys
KeyUp         = I
KeyLeft       = J
KeyDown       = K
KeyRight      = L

Direction     = KeyUp | KeyLeft | KeyDown | KeyRight

Leader   = Comma

# Forward standard modifiers
Meta     >> Meta
Control  >> Control
AltRight >> AltRight

# Mouse button actions
ButtonForward{150ms}             >> window_move
ButtonBack{150ms}                >> window_resize
ButtonForward !150ms ButtonRight >> wm_close_window

# CapsWord key
[default]
  CapsWordToggle = Virtual1
  CapsWord       = CapsLock CapsWordToggle ^
  CapsWordKey    = Letter | Number | Minus | Backspace

  Shift{200ms}          >> Shift
  ShiftLeft{ShiftRight} >> CapsWord
  Shift{CapsLock}       >> CapsWord

[modifier="CapsWordToggle"]
  Minus            >> Shift{Minus} # '_'
  CapsWordKey      >> CapsWordKey
  !CapsWordKey Any >> CapsLock CapsWordToggle Any


[device="MX Anywhere 2S Mouse"]
  ButtonMiddle{150ms}              >> wm_float_toggle


[device=/Keychron K15 Pro/]
  Macro1      = F13
  Option      = F14
  Command     = F15
  Lock        = F16
  SpaceLeft   = F17
  EscMiddle   = F18

  SpaceKey    = Space | SpaceLeft

  Macro1                           >>
  Option                           >>

  Backquote{200ms}                 >> F13
  Backquote                        >> Backquote

  Command{L}                       >> $($HOME/.config/regolith/rofi/rofi-hass-scene.sh) ^
  Command                          >> $(rofi -show window) ^

  Lock{250ms}                      >> Shift{Lock} 200ms ShiftLeft ^
  Lock                             >>

  EscMiddle{!200ms}                >> Escape
  EscMiddle                        >>

  SpaceLeft{!135ms}                >> Space

  (Shift SpaceLeft){KeyUp}         >> Win{Shift{BracketLeft}}
  (Shift SpaceLeft){KeyLeft}       >> Win{Shift{Semicolon}}
  (Shift SpaceLeft){KeyDown}       >> Win{Shift{Quote}}
  (Shift SpaceLeft){KeyRight}      >> Win{Shift{Backslash}}

  (Shift SpaceLeft){Workspace}     >> Win{Shift{Workspace}}

  SpaceLeft{WMShortcut}            >> Win{WMShortcut}

  SpaceLeft{KeyUp}                 >> Win{BracketLeft}
  SpaceLeft{KeyLeft}               >> Win{Semicolon}
  SpaceLeft{KeyDown}               >> Win{Quote}
  SpaceLeft{KeyRight}              >> Win{Backslash}

  SpaceLeft{BracketLeft}           >> wm_show_terminal
  SpaceLeft{Q}                     >> wm_close_window
  SpaceLeft{Quote}                 >> type_adieresis
  SpaceLeft{Semicolon}             >> type_odieresis
  SpaceLeft                        >>

  AdieresisKey = A | Quote
  OdieresisKey = O | Semicolon

  AltGr{AdieresisKey}              >> type_adieresis
  AltGr{OdieresisKey}              >> type_odieresis
  AltGr{E}                         >> AltGr{5}
  AltGr{2}                         >> ^Shift{2}
  AltGr{4}                         >> ^Shift{4}

  type_adieresis                   >> AltGr{Q}
  type_odieresis                   >> AltGr{P}

[device=/Keychron K15 Pro/ class=/slack|google-chrome/i]
  LeaderEsc = EscMiddle !250ms
  EscMiddle{!250ms} >> Escape

  Leader            >> Comma
  Leader Any        >> Any

  LeaderEsc F       >> slack_switch_channel
  LeaderEsc 1       >> slack_goto_workspace1
  LeaderEsc 2       >> slack_goto_workspace2
  LeaderEsc H       >> slack_goto_home
  LeaderEsc A       >> slack_goto_activity
  LeaderEsc D       >> slack_goto_dms
  LeaderEsc T       >> slack_goto_threads
  LeaderEsc L       >> slack_goto_later

  LeaderEsc T       >> new_tab
  LeaderEsc X       >> close_tab
  LeaderEsc W       >> close_tab
  LeaderEsc L       >> goto_location


[device=/Keychron K3 Pro/ class="kitty" title=/^.* - N?VIM$/]
  BracketLeft        >> Escape


[class=/jetbrains-/]
  Editor = E
  Focus  = F
  Goto   = G

  FocusKey = Direction | N | P

  Editor{Direction}   >> AltGr{Control{Direction}}
  Editor{Any}         >> Editor Any

  Focus{FocusKey}     >> AltGr{AltLeft{FocusKey}}
  Focus{Any}          >> Focus Any

  Goto{D}             >> goto_declaration
  Goto{I}             >> goto_implementation
  Goto{F}             >> goto_file
  Goto{S}             >> goto_symbol
  Goto{Any}           >> Goto Any

  Editor{!75ms}       >> Editor
  Focus{!75ms}        >> Focus
  Goto{!75ms}         >> Goto

  !Control !AltLeft Shift{Enter} >> End

  goto_declaration    >> Control{B}
  goto_implementation >> Control{AltLeft{B}}
  goto_file           >> AltLeft{P}
  goto_symbol         >> AltLeft{Shift{P}}


[class="slack"]
  Leader F                >> slack_switch_channel
  Leader 1                >> slack_goto_workspace1
  Leader 2                >> slack_goto_workspace2
  Leader H                >> slack_goto_home
  Leader A                >> slack_goto_activity
  Leader D                >> slack_goto_dms
  Leader T                >> slack_goto_threads
  Leader L                >> slack_goto_later

  Alt{Space}              >> slack_switch_channel
  Alt{1}                  >> slack_goto_workspace1
  Alt{2}                  >> slack_goto_workspace2
  Alt{Tab}                >> slack_next_section
  Alt{Shift{Tab}}         >> slack_prev_section
  Alt{KeyUp}              >> slack_prev_chat
  Alt{KeyDown}            >> slack_next_chat

  Alt{KeyLeft}            >> navigate_back
  Alt{KeyRight}           >> navigate_forward

  slack_goto_home         >> (Control Shift){1}
  slack_goto_dms          >> (Control Shift){2}
  slack_goto_activity     >> (Control Shift){3}
  slack_goto_later        >> (Control Shift){4}
  slack_goto_threads      >> (Control Shift){T}
  slack_switch_channel    >> Control{K}
  slack_next_chat         >> AltLeft{ArrowDown}
  slack_prev_chat         >> AltLeft{ArrowUp}
  slack_goto_workspace1   >> Control{1}
  slack_goto_workspace2   >> Control{2}
  slack_next_section      >> F6
  slack_prev_section      >> Shift{F6}


[class="google-chrome"]
  Leader T          >> new_tab
  Leader X          >> close_tab
  Leader L          >> goto_location

  AltGr{T}          >> new_tab
  AltGr{W}          >> close_tab
  AltGr{Any}        >> AltGr{Any}

  Alt{T}            >> new_tab
  Alt{W}            >> close_tab
  Alt{PageUp}       >> prev_tab
  Alt{PageDown}     >> next_tab

  Alt{KeyLeft}      >> prev_tab
  Alt{KeyRight}     >> next_tab
  Alt{KeyUp}        >> scroll_up
  Alt{KeyDown}      >> scroll_down

  goto_location     >> !Win Control{L}
  scroll_up         >> ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp ArrowUp
  scroll_down       >> ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown ArrowDown


[default]
  new_tab           >> !Win Control{T}
  close_tab         >> !Win Control{W}
  prev_tab          >> !Win Control{PageUp}
  next_tab          >> !Win Control{PageDown}
  navigate_back     >> !Win AltLeft{ArrowLeft}
  navigate_forward  >> !Win AltLeft{ArrowRight}

  window_move       >> (AltLeft ButtonLeft)
  window_resize     >> (AltLeft ButtonRight)

  wm_show_terminal  >> Meta{K}
  wm_close_window   >> ^Meta{Shift{Q}}
  wm_float_toggle   >> Meta{Escape}

# vim: ft=perl sw=2 ts=2 expandtab
